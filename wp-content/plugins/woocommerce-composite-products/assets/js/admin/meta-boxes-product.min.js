jQuery(function(u){var n=u("select#product-type"),m=u("#bto_product_data"),r=m.find("#_bto_shop_price_calc"),f=m.find(".bulk_toggle_wrapper"),e=u(".config_group",m),i=u(".bto_groups",e),h=u(".bto_group",i),F=h.length,g={},v=u("#bto_scenario_data"),L=v.find(".bulk_toggle_wrapper"),I=u(".scenarios_config_group",v),a=u(".bto_scenarios",v),b=u(".bto_scenario",a),O=b.length,w={},y=u("#bto_state_data"),N=y.find(".bulk_toggle_wrapper"),M=u(".states_config_group",y),s=u(".bto_states",y),$=u(".bto_state",s),R=$.length,k={},U=!1,o={image_frame:!1,$button:!1},c={message:null,overlayCSS:{background:"#fff",opacity:.6}},d={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200},J=[],Q=!1,B=!1,x=y.length,C=!1,l=m.parent().find("#shipping_product_data"),p=u("input#_virtual"),z=u("input#_virtual_composite"),G=p.prop("checked"),K=!1,t=l.find(".options_group.composite_type"),q=t.find(".bto_type_options button"),T=u("#_sold_individually").closest(".form-field");function V(t){var c=this;this.$el=t,this.$content=t.find(".bto_group_data"),this.$metabox_title=t.find("h3 .group_name"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".tab_group"),this.$discount=this.$content.find(".group_discount"),this.$filters=this.$content.find(".group_filters"),this.$display_prices=this.$content.find(".component_display_prices"),this.$pagination_style=this.$content.find(".component_pagination_style"),this.$query_type_containers=this.$content.find(".component_query_type_selector"),this.$query_type_selector=this.$content.find("select.component_query_type"),this.$options_style_container=this.$content.find(".component_options_style"),this.$options_style_selector=this.$content.find("select.options_style_selector"),this.$categories_selector=this.$content.find("select.categories_selector"),this.$products_selector=this.$content.find("select.products_selector"),this.$default_selectors_container=this.$content.find(".default_selector_container"),this.$default_selectors=this.$content.find(".default_selector_wrapper"),this.$default_selector_categories=this.$content.find("select.default_selector_categories"),this.$default_selector_products=this.$content.find("select.default_selector_products"),this.$optional_checkbox=this.$content.find("input.component_optional"),this.$title_input=this.$content.find("input.group_title"),this.$priced_individually_input=this.$content.find(".group_priced_individually input"),this.$sort_filter_container=this.$content.find(".options_group_component--sort-filter"),this.$show_filters_input=this.$content.find(".group_show_filters input"),this.$min_qty=this.$content.find("div.group_quantity_min"),this.$min_qty_input=this.$min_qty.find("input.group_quantity_min"),this.$max_qty=this.$content.find("div.group_quantity_max"),this.$max_qty_input=this.$max_qty.find("input.group_quantity_max"),this.max_qty_prev=this.$max_qty_input.val(),this.initialized_content=!1,this.component_toggled=function(){var t=c.maybe_initialize_content(),e=this.$el,o=this.$content;setTimeout(function(){e.toggleClass("closed").toggleClass("open"),o.stop().slideToggle()},t?50:10)},this.maybe_initialize_content=function(){var t=!1;return c.initialized_content||(t=!0,c.initialize_content()),t},this.validate_quantity=function(t,e){var o=c.$min_qty_input,n=(o="max"===t?c.$max_qty_input:o).val(),i=parseFloat(o.attr("min")),a=parseFloat(o.attr("max")),o=parseFloat(o.attr("step")),s={qty:n,error:""};return 0<=i&&(n<i||isNaN(n))?"max"===t&&""===n||(s.qty="max"===e?c.max_qty_prev:i,s.error=wc_composite_admin_params.i18n_qty_low_error.replace("%s",i)):0<a&&a<n?(s.qty=a,s.error=wc_composite_admin_params.i18n_qty_high_error.replace("%s",a)):0<o&&0<n&&n%o&&(s.qty=o*Math.ceil(n/o),s.error=wc_composite_admin_params.i18n_qty_step_error.replace("%s",o)),s},this.section_changed=function(t){c.$section_links.removeClass("current"),t.addClass("current"),c.$sections.addClass("tab_group_hidden"),c.$content.find(".tab_group_"+t.data("tab")).removeClass("tab_group_hidden")},this.title_changed=function(){c.$metabox_title.text(c.$title_input.val()),E(!0)},this.query_type_changed=function(){c.$query_type_containers.hide(),c.$default_selectors.hide();var t=c.$query_type_selector.val();c.$content.find(".component_query_type_"+t).show(),this.initialized_content&&(c.toggle_static_component_content(),"category_ids"===t?(c.reinitialize_default_option_category_select(),c.maybe_update_default_option_category_ids(!0)):(c.initialize_default_option_product_select(),c.default_option_changed()),E(!0))},this.products_changed=function(){c.toggle_static_component_content(),c.initialize_default_option_product_select(),c.default_option_changed(),E(!0)},this.categories_changed=function(){var t=c.get_category_ids();c.$default_selector_categories.data("include",t.join()),c.maybe_update_default_option_category_ids(!0),E(!0)},this.optional_changed=function(){c.toggle_static_component_content(),c.default_option_changed(),E(!0)},this.options_style_changed=function(){this.initialized_content&&("yes"!==c.$options_style_selector.find('option[value="'+c.$options_style_selector.val()+'"]').data("supports").pagination||c.is_static()?c.$pagination_style.hide():c.$pagination_style.show())},this.priced_individually_input_changed=function(){c.$priced_individually_input.is(":checked")?(c.$discount.show(),c.$display_prices.show()):(c.$discount.hide(),c.$display_prices.hide())},this.show_filters_input_changed=function(){c.$show_filters_input.is(":checked")?c.$filters.show():c.$filters.hide()},this.toggle_static_component_content=function(){c.is_static()?(c.$options_style_container.hide(),c.$sort_filter_container.hide()):(c.$options_style_container.show(),c.$sort_filter_container.show()),c.options_style_changed()},this.default_option_changed=function(){var t,e=c.$query_type_selector.val(),o=c.get_default_option(),n=c.get_default_option_html(),i=("category_ids"===e?c.$default_selector_categories:c.$default_selector_products).val(),a=!0,s=!1;i||c.is_optional()||("category_ids"===e?"defaults"===r.val()&&0<c.get_category_ids().length&&(s="set_defaults"):0<(t=c.get_product_ids().length)&&("defaults"===r.val()?s="set_defaults":1===t&&(s="set_defaults_static"))),s&&(c.has_error(c.$default_selectors_container)||(setTimeout(function(){c.add_error_tip(c.$default_selectors_container,s)},5),o)||c.add_error(c.$default_selectors_container,s),"product_ids"===e?c.$default_selector_products.val(o).triggerHandler("change"):n&&c.$default_selector_categories.append(n).val(o).triggerHandler("change"),a=!1),a&&(c.clear_error(c.$default_selectors_container),c.set_default_option(i))},this.add_error_tip=function(t,e){var o=t.position();0===t.parent().find(".wc_error_tip").length&&(t.after('<div class="wc_error_tip">'+wc_composite_admin_params["i18n_"+e]+"</div>"),t.parent().find(".wc_error_tip").css("left",o.left+t.width()-t.width()/2-u(".wc_error_tip").width()/2).css("top",o.top+t.height()).fadeIn("100"))},this.add_formatted_error_tip=function(t,e){var o=t.position();0===t.parent().find(".wc_error_tip").length&&(t.after('<div class="wc_error_tip">'+e+"</div>"),t.parent().find(".wc_error_tip").css("left",o.left+t.width()-t.width()/2-u(".wc_error_tip").width()/2).css("top",o.top+t.height()).fadeIn("100"))},this.remove_error_tip=function(t){t.parent().find(".wc_error_tip").fadeOut("100",function(){u(this).remove()})},this.has_error=function(t){return t.hasClass("selection_error")},this.add_error=function(t,e){t.find(".wc-cp-error-tip").attr("data-tip",wc_composite_admin_params["i18n_"+e]),t.find(".wc-cp-error-tip").tipTip(d),t.addClass("selection_error")},this.clear_error=function(t){t.removeClass("selection_error")},this.initialize=function(){c.query_type_changed(),c.options_style_changed(),c.priced_individually_input_changed(),c.show_filters_input_changed()},this.initialize_default_option_category_select=function(){void 0===c.get_default_option_html()&&c.save_default_option_html()},this.reinitialize_default_option_category_select=function(){var t=c.get_default_option(),e=c.get_default_option_html();e&&c.$default_selector_categories.append(e),c.$default_selector_categories.val(t).triggerHandler("change")},this.initialize_default_option_product_select=function(){var t=c.$products_selector.find(":selected").clone().prop("selected",!1).removeAttr("selected").removeAttr("data-select2-id"),e=c.get_default_option()&&0<t.filter('[value="'+c.get_default_option()+'"]').length;c.$default_selector_products.find("option").remove(),c.$default_selector_products.append(t),c.$default_selector_products.prepend("<option/>"),e||(e=!c.is_optional()&&0<t.length&&("defaults"===r.val()||1===t.length)?t.first().val():0,c.set_default_option(e)),c.$default_selector_products.val(c.get_default_option()).triggerHandler("change")},this.initialize_content=function(){"category_ids"===c.$query_type_selector.val()?c.initialize_default_option_category_select():c.initialize_default_option_product_select(),c.initialize_select2s(),c.$content.find(".woocommerce-help-tip").tipTip(d),c.initialized_content=!0,m.triggerHandler("wc-cp-component-initialized",[c])},this.initialize_select2s=function(){c.$content.sw_select2({sortable:{stop:function(t){t.hasClass("products_selector")&&(t=t.closest(".bto_group").data("component_metabox_id"),g[t].products_changed())}}})},this.maybe_update_default_option_category_ids=function(e){var t;e=e||!1,null===c.get_default_option_category_ids()?(c.update_default_option_category_ids_xhr&&c.update_default_option_category_ids_xhr.abort(),t={action:"woocommerce_get_product_categories",product_id:c.get_default_option(),security:wc_composite_admin_params.get_product_categories_nonce},c.update_default_option_category_ids_xhr=u.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){c.set_default_option_category_ids("success"===t.result?t.category_ids:[]),e&&c.check_default_option_in_category_ids()})):e&&c.check_default_option_in_category_ids()},this.check_default_option_in_category_ids=function(){(c.get_default_option()&&!c.is_default_option_in_category_ids()||0===c.get_category_ids().length)&&(c.set_default_option(0),c.$default_selector_categories.val(0).trigger("change"))},this.is_default_option_in_category_ids=function(){var t=c.get_selector_data(c.$categories_selector),e=c.get_default_option_category_ids(),o=[],n=(u.each(t,function(t,e){o.push(parseInt(e.id))}),!1);return u.each(e,function(t,e){if(c.array_contains(parseInt(e),o))return!(n=!0)}),n},this.get_default_option_category_ids=function(){return this.$default_selectors_container.data("selected_data").default_option_category_ids},this.set_default_option_category_ids=function(t){this.$default_selectors_container.data("selected_data").default_option_category_ids=t},this.get_default_option_html=function(){return this.$default_selectors_container.data("selected_data").default_option_html},this.save_default_option_html=function(){var t,e=this.$default_selectors_container.data("selected_data");c.get_default_option()?(t=("category_ids"===c.$query_type_selector.val()?c.$default_selector_categories:c.$default_selector_products).find(":selected").clone(),e.default_option_html=t):e.default_option_html=!1},this.get_default_option=function(){return this.$default_selectors_container.data("selected_data").default_option_id||0},this.set_default_option=function(t){var e=this.$default_selectors_container.data("selected_data");e.default_option_id=t||0,c.save_default_option_html(),c.set_default_option_category_ids(!!e.default_option_id&&null),c.maybe_update_default_option_category_ids()},this.get_selector_data=function(t){return t.selectSW("data")},this.get_category_ids=function(){var t=c.get_selector_data(c.$categories_selector),o=[];return u.each(t,function(t,e){o.push(parseInt(e.id))}),o},this.get_product_ids=function(){var t=c.get_selector_data(c.$products_selector),o=[];return u.each(t,function(t,e){o.push(parseInt(e.id))}),o},this.array_contains=function(t,e){return-1!==u.inArray(t,e)},this.is_optional=function(){return c.$optional_checkbox.is(":checked")},this.is_static=function(){var t=c.$query_type_selector.val();if("product_ids"===t&&(1===c.get_product_ids().length&&!c.is_optional()))return!0;return!1},this.initialize()}function E(t){U=t=!!t}function X(){0<h.length?(e.removeClass("no-components"),f.removeClass("disabled")):(e.addClass("no-components"),f.addClass("disabled"))}function Y(){g={},h.each(function(t){var e=u(this),t="component_"+t;e.data("component_metabox_id",t),g[t]=new V(e)}),i.sortable({items:".bto_group",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),m.triggerHandler("wc-cp-components-changed")}}),X()}function H(t,e){var p=this;if(t.length&&e.length){if(!(this instanceof H))return new H(t,e);this.templates={row:"wc_cp_condition_row",condition:"wc_cp_%%type%%_condition_content",add:"wc_cp_condition_add_content",component_option:"wc_cp_condition_component_option"},this.os_row_template=!1,this.os_condition_templates={},this.os_add_template=!1,this.os_component_option_template=!1,this.$data_container=1<t.length?t.first():t,this.$components_container=1<e.length?e.first():e,this.$add_container=this.$data_container.find(".os_add"),this.$add_os_select=this.$data_container.find(".os_add select.os_type"),this.$list=this.$data_container.find(".os_list"),this.$boarding=this.$data_container.find(".os_boarding"),this.modifiers=this.$list.data("os_modifiers")?this.$list.data("os_modifiers"):{},this.options_count=parseInt(this.$list.find(".os_row").length,10),this.allow_unique_additions="yes"===this.$data_container.data("unique_additions")?"yes":"no",this.components_select_options=!1,this.$add_container.length&&this.$add_os_select.length&&this.$list.length&&(this.$list.cp_scenario_conditions_scripts(),this.$data_container.on("mousedown",".os_remove .trash",function(){u(this).triggerHandler("mouseleave")}).on("click",".os_remove .trash",function(t){return t.preventDefault(),u(this).closest(".os_row").remove(),p.$data_container.trigger("os_removed",[p]),p.options_count--,p.maybe_add_boarding(),!0}).on("change",".os_modifier select",function(){var t=u(this),o=t.val(),t=t.closest(".os_row_inner").find(".os_value div[data-modifiers]");t.length&&(t.hide(),t.each(function(){var t=u(this),e=t.data("modifiers").split(",");e&&-1!==e.indexOf(o)&&t.show()}))}).on("change",".os_add select.os_type",function(){var e,t=u(this),o=t.val();if("add"!==o){if(p.allow_unique_additions)if(p.$list.find("select.os_type").each(function(){var t=u(this).find(":selected");if(t&&t.length&&o===t.val())return e=u(this),!1}),e&&e.length)return e.trigger("focus"),t.find('option[value="add"]').prop("selected","selected"),!1;var n=p.$components_container.find("#component_query_type_"+o);if(n&&!(n.length<1)){var i,a=parseInt(p.$data_container.attr("data-os_count"),10)+1,s=p.$data_container.attr("data-os_post_name"),c="yes"===n.data("use_ajax")?"ajax":"flat",_=n.data("component_options")?n.data("component_options"):[],n=p.get_os_row_template(),c=p.get_os_condition_template(c),r=p.get_os_component_option_template(),d=p.get_component_select_options();if(n&&c){if(_)for(var l=0;l<_.length;l++)i+=r({option_value:_[l].option_value,option_label:_[l].option_label});n=n({os_index:a,os_components:d,os_content:c({os_post_name:s,os_component_id:o,os_component_options_html:i})}),d=(p.$data_container.attr("data-os_count",a),n=p.prepare_new_row(n),p.$list.append(n),p.$list.find(".os_row").last());d.find('.os_type option[value="'+o+'"]').prop("selected","selected"),p.$data_container.trigger("os_added",[p]),d.cp_scenario_conditions_scripts(),p.options_count++,p.maybe_add_boarding(),t.find('option[value="add"]').prop("selected","selected")}}}return!1}),this.$list.on("change","select.os_type",function(){var t=u(this),e=t.closest(".os_row"),t=t.val(),o=p.$components_container.find("#component_query_type_"+t);if(o&&!(o.length<1)){var n,i=p.$data_container.attr("data-os_post_name"),a="yes"===o.data("use_ajax")?"ajax":"flat",s=o.data("component_options")?o.data("component_options"):[],o=p.get_os_condition_template(a),c=p.get_os_component_option_template();if(o&&c){if(s)for(var _=0;_<s.length;_++)n+=c({option_value:s[_].option_value,option_label:s[_].option_label});a=o({os_post_name:i,os_component_id:t,os_component_options_html:n}),a=p.prepare_new_row(a);e.find(".os_content").html(a),p.$data_container.trigger("os_changed",[p]),e.cp_scenario_conditions_scripts()}}return!1}),this.$components_container.on("wc-cp-components-changed",function(){p.components_select_options=!1}))}}function Z(t){var c=this;this.$el=t,this.$content=t.find(".bto_scenario_data"),this.$metabox_title=t.find("h3 .scenario_name .scenario_name_inner"),this.$non_effective_conditions_tip=t.find(".scenario-help-tip--non-effective-conditions"),this.$title_input=this.$content.find("input.bto_scenario_data_title"),this.render_content=this.$content.data("scenario_content"),this.$cc_action_input=this.$content.find("input.scenario_action_conditional_components_input"),this.$co_action_input=this.$content.find("input.scenario_action_conditional_options_input"),this.$cc_component_ids=this.$content.find("select.conditional_components_ids"),this.conditions_stack=!1,this.hidden_options_stack=!1,this.initialized_content=!1,this.scenario_toggled=function(){var t,e,o=this.$el,n=this.$content;Q||(e=(t=c.maybe_initialize_content())&&A()?200:t?50:10,setTimeout(function(){o.toggleClass("closed").toggleClass("open"),n.stop().slideToggle({always:function(){t&&A()&&(c.$el.removeClass("loading"),Q=!1)}})},e))},this.maybe_initialize_content=function(){var t=!1,e=A()?100:10;return c.initialized_content||(t=!0,A()&&(c.$el.addClass("loading"),Q=!0),setTimeout(function(){c.initialize_content()},e)),t},this.title_changed=function(){c.$metabox_title.text(c.$title_input.val())},this.initialize_content=function(){""!==c.render_content&&(c.$content.html(c.render_content),c.$title_input=c.$content.find("input.bto_scenario_data_title"),c.$cc_action_input=c.$content.find("input.scenario_action_conditional_components_input"),c.$co_action_input=c.$content.find("input.scenario_action_conditional_options_input"),c.$cc_component_ids=c.$content.find("select.conditional_components_ids")),c.initialize_select2s(),c.$content.find(".tips, .woocommerce-help-tip").tipTip(d),c.initialized_content=!0,v.triggerHandler("wc-cp-scenario-initialized",c)},this.initialize_select2s=function(){c.$content.sw_select2({sortable:{stop:function(t){t.hasClass("products_selector")&&(t=t.closest(".bto_group").data("component_metabox_id"),g[t].products_changed())}}})},this.update_non_effective_conditions_tip=function(){var n={},t=c.conditions_stack.$add_os_select.find("option"),e=c.conditions_stack.$list.find(".os_row"),o=c.hidden_options_stack.$list.find(".os_row"),i=c.$cc_component_ids.val(),a=0,s=1e4;t.length||c.$non_effective_conditions_tip.fadeOut(200),e.length||c.$non_effective_conditions_tip.fadeOut(200),t.each(function(t,e){e=u(e).val();if("add"===e)return!0;n[e]=t}),e.each(function(t,e){var o=u(e).find("select.os_type").val();if("in-any"===u(e).find(".os_modifier select").val())return!0;a<n[o]&&(a=n[o])}),c.$cc_action_input.is(":checked")&&u.each(i,function(t,e){n[e]<s&&(s=n[e])}),c.$co_action_input.is(":checked")&&o.each(function(t,e){e=u(e).find("select.os_type").val();n[e]<s&&(s=n[e])}),s<=a?c.$non_effective_conditions_tip.fadeIn(200):c.$non_effective_conditions_tip.fadeOut(200)},this.initialize=function(){c.$non_effective_conditions_tip.tipTip(d)},this.initialize()}function A(){return 20<h.length}function tt(){0<b.length?L.removeClass("disabled"):L.addClass("disabled")}function et(){w={},b.each(function(t){var e=u(this),t="scenario_"+t;e.data("scenario_metabox_id",t),w[t]=new Z(e)}),a.sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),v.triggerHandler("wc-cp-scenarios-changed")}}),tt()}q.find(".woocommerce-help-tip").attr("tabindex",-1),($layout_options=m.find(".bto_layouts_list .bto_layout_button")).find(".woocommerce-help-tip").attr("tabindex",-1),u.each(wc_composite_admin_params.layouts,function(t,e){J.push("layout-"+e)}),u(".composite_stock_msg").appendTo("._manage_stock_field .description"),T.addClass("hide_if_composite"),T.siblings(".woocommerce-help-tip").addClass("hide_if_composite"),u("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_composite"),u(".show_if_simple:not(.hide_if_composite)").addClass("show_if_composite"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),u("body").on("woocommerce-product-type-change",function(t,e){"composite"===e&&(u(".show_if_external").hide(),u(".show_if_composite").show(),u("input#_manage_stock").trigger("change"),K&&z.prop("checked",p.prop("checked")),z.prop("checked")||p.prop("checked",!1).change(),"unassembled"===q.find("input.composite_type_option:checked").first().val())&&(l.addClass("composite_unassembled"),m.addClass("composite_unassembled"))}),p.on("change",function(){p.prop("checked")!==G&&(K=!0)}),u("form#post").on("submit",function(){var t,e,o;"composite"===n.val()&&(t=u(this),e=u('<input type="hidden" name="cp_post_control_var" value="1"/>'),o=u('<input type="hidden" name="cp_post_test_var" value="1"/>'),t.prepend(e),t.append(o))}),u("input#_downloadable").on("change",function(){n.trigger("change")}),r.data("val",r.val()),m.off("click").on("click",".bto_layout_button",function(t){t.isDefaultPrevented()||((t=u(this)).closest(".bto_layouts").find(".selected").removeClass("selected"),t.addClass("selected"),e.removeClass(J.join(" ")),e.addClass("layout-"+t.find("input").val()))}).on("change","#_bto_shop_price_calc",function(){var t=u(this).val(),o=!1;"defaults"===t&&u.each(g,function(t,e){if(!e.is_optional()&&!e.get_default_option())return o=!0,window.alert(wc_composite_admin_params.i18n_defaults_unset),r.val(r.data("val")),!1}),o||r.data("val",t)}).one("wc-cp-component-added",function(){e.removeClass("options_group--boarding")}).on("wc-cp-components-changed",function(){i=u(".bto_groups",e),(h=u(".bto_group",i)).each(function(t,e){u(".group_position",e).val(t),u(e).attr("rel",t)}),E(!0),X()}),v.off("click").one("wc-cp-scenario-added",function(){I.removeClass("options_group--boarding")}).on("wc-cp-scenarios-changed",function(){a=u(".bto_scenarios",v),(b=u(".bto_scenario",a)).each(function(t,e){u(".scenario_position",e).val(t),u(e).attr("rel",t)}),tt()}),x&&y.off("click").one("wc-cp-state-added",function(){M.removeClass("options_group--boarding")}).on("wc-cp-states-changed",function(){s=u(".bto_states",y),($=u(".bto_state",s)).each(function(t,e){u(".state_position",e).val(t),u(e).attr("rel",t)}),it()}),e.on("click",".expand_all",function(){return u(this).hasClass("disabled")||u.each(g,function(t,e){e.initialize_content(),setTimeout(function(){e.$el.addClass("open").removeClass("closed"),e.$content.show()},50)}),!1}).on("click",".close_all",function(){return u(this).hasClass("disabled")||u.each(g,function(t,e){setTimeout(function(){e.$el.addClass("closed").removeClass("open"),e.$content.hide()},10)}),!1}).on("click",".bto_group_handle",function(){var t=u(this).closest(".bto_group").data("component_metabox_id"),t=g[t];void 0!==t&&t.component_toggled()}).on("click",".bto_group_handle .component-id-item",function(){return!1}).on("click",".subsubsub a",function(t){var e=u(this),o=u(this).closest(".bto_group").data("component_metabox_id");g[o].section_changed(e),t.preventDefault()}).on("click","a.remove_row",function(t){var e=u(this).closest(".bto_group"),o=e.data("component_metabox_id");e.find("*").off(),e.remove(),delete g[o],m.triggerHandler("wc-cp-components-changed"),t.preventDefault()}).on("click","button.add_bto_group",function(){m.block(c),F++;var t={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:F,security:wc_composite_admin_params.add_component_nonce};return setTimeout(function(){u.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){i.append(t);var t=u(".bto_group",i).last(),e=new V(t),o="component_"+F;t.data("component_metabox_id",o),g[o]=e,m.triggerHandler("wc-cp-components-changed"),e.initialize_content(),m.triggerHandler("wc-cp-component-added",[e]),m.unblock()})},250),!1}).on("keyup","input.group_title",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].title_changed()}).on("change","select.component_query_type",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].query_type_changed()}).on("change","select.categories_selector",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].categories_changed()}).on("change","select.products_selector",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].products_changed()}).on("change","select.default_selector_categories",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].default_option_changed()}).on("change","select.default_selector_products",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].default_option_changed()}).on("change","input.component_optional",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].optional_changed()}).on("change","select.options_style_selector",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].options_style_changed()}).on("change",".group_priced_individually input",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].priced_individually_input_changed()}).on("input change","input.group_quantity",function(t){var e,o,n=u(this),i=n.closest(".bto_group").data("component_metabox_id"),a=g[i],i="min",s=(n.hasClass("group_quantity_max")&&(i="max"),a.validate_quantity(i,i));s.error?"input"===event.type?setTimeout(function(){a.add_formatted_error_tip(n,s.error)},5):n.val(s.qty).change():(a.remove_error_tip(n),"change"===event.type&&(e=a.$min_qty_input.val(),o=a.$max_qty_input.val(),a.$max_qty_input.attr("min",e),(s=a.validate_quantity("max",i)).error&&(a.$max_qty_input.val(s.qty),o=s.qty),a.max_qty_prev=o))}).on("change",".group_show_filters input",function(){var t=u(this).closest(".bto_group").data("component_metabox_id");g[t].show_filters_input_changed()}).on("click",".upload_component_image_button",function(t){o.$button=u(this),t.preventDefault(),o.image_frame||(o.image_frame=wp.media({title:wc_composite_admin_params.i18n_choose_component_image,button:{text:wc_composite_admin_params.i18n_set_component_image},states:[new wp.media.controller.Library({title:wc_composite_admin_params.i18n_choose_component_image,filterable:"all"})]}),o.image_frame.on("select",function(){var t=o.image_frame.state().get("selection").first().toJSON(),e=(t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail:t).url;o.$button.addClass("has_image"),o.$button.closest(".component_image").find(".remove_component_image_button").addClass("has_image"),o.$button.find("input").val(t.id).trigger("change"),o.$button.find("img").eq(0).attr("src",e)})),o.image_frame.open()}).on("click",".remove_component_image_button",function(t){var e=u(this),o=e.closest(".component_image"),n=o.find(".upload_component_image_button");t.preventDefault(),n.removeClass("has_image"),e.removeClass("has_image"),o.find("input").val("").trigger("change"),n.find("img").eq(0).attr("src",wc_composite_admin_params.wc_placeholder_img_src)}),Y(),H.prototype={reset_options:function(){this.$list.html(""),this.$data_container.attr("data-filters_count",0),this.options_count=0,this.maybe_add_boarding()},get_os_row_template:function(){var t=!1;return"function"==typeof this.os_row_template?t=this.os_row_template:(t=wp.template(this.templates.row),this.os_row_template=t),t},get_os_condition_template:function(t){var e,o=!1;return"function"==typeof this.os_condition_templates[t]?o=this.os_condition_templates[t]:(e=(e=this.templates.condition).replace("%%type%%",t),o=wp.template(e),this.os_condition_templates[t]=o),o},get_os_add_template:function(){var t=!1;return"function"==typeof this.os_add_template?t=this.os_add_template:(t=wp.template(this.templates.add),this.os_add_template=t),t},get_os_component_option_template:function(){var t=!1;return"function"==typeof this.os_component_option_template?t=this.os_component_option_template:(t=wp.template(this.templates.component_option),this.os_component_option_template=t),t},maybe_add_boarding:function(){0==this.options_count?(this.$data_container.addClass("os_empty"),this.$list.addClass("hidden"),this.$boarding.addClass("active"),this.$add_container.addClass("os_add--boarding")):(this.$data_container.removeClass("os_empty"),this.$list.removeClass("hidden"),this.$boarding.removeClass("active"),this.$add_container.removeClass("os_add--boarding"))},prepare_new_row:function(t){t=u(t);if(!u.isEmptyObject(this.modifiers)){var e,o=t.find(".os_modifier select"),n="";for(e in this.modifiers)n+="<option value="+e+">"+this.modifiers[e]+"</option>";o.html(n)}return t},get_component_select_options:function(){var e="";return!1!==this.components_select_options?e=this.components_select_options:(this.$add_container.find("select.os_type").children().each(function(){var t=u(this);"add"!==t.val()&&(e+='<option value="'+t.val()+'">'+t.text()+"</option>")}),this.components_select_options=e),e}},u.fn.cp_scenario_conditions_scripts=function(){var t=u(this);t.sw_select2(),t.find(".woocommerce-help-tip, .help_tip, .tips").tipTip(d)},v.on("wc-cp-scenario-initialized",function(t,e){var o=e.$content.find(".wc-cp-scenario-conditions-container"),o=(o&&o.length&&(e.conditions_stack=new H(o,m)),e.$content.find(".action_options .os_container"));o&&o.length&&(e.hidden_options_stack=new H(o,m))}),I.on("click",".expand_all",function(){return u(this).hasClass("disabled")||u.each(w,function(t,e){e.initialize_content(),setTimeout(function(){e.$el.addClass("open").removeClass("closed"),e.$content.show()},50)}),!1}).on("click",".close_all",function(){return u(this).hasClass("disabled")||u.each(w,function(t,e){setTimeout(function(){e.$el.addClass("closed").removeClass("open"),e.$content.hide()},10)}),!1}).on("click",".bto_scenario_handle",function(){var t=u(this).closest(".bto_scenario").data("scenario_metabox_id"),t=w[t];void 0!==t&&t.scenario_toggled()}).on("click","a.remove_row",function(t){var e=u(this).closest(".bto_scenario"),o=e.data("scenario_metabox_id");e.find("*").off(),e.remove(),delete w[o],v.triggerHandler("wc-cp-scenarios-changed"),t.preventDefault()}).on("keyup","input.bto_scenario_data_title",function(){var t=u(this).closest(".bto_scenario").data("scenario_metabox_id");w[t].title_changed()}).on("change",".toggle_scenario_action_config input",function(){var t=u(this),e=t.is(":checked"),t=t.closest(".scenario_action_config_group").find(".action_config");t&&t.length&&(e?t.show():t.hide())}).on("click",".woocommerce-input-toggle",function(){var t=u(this),e=t.closest(".wc-metabox");return ct(t,e.find(".bto_scenario_handle .handle > input.enabled")),!1}).on("click","button.add_bto_scenario",function(){v.block(c),O++;var t={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:O,security:wc_composite_admin_params.add_scenario_nonce};return setTimeout(function(){u.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){a.append(t);var t=u(".bto_scenario",a).last(),e=new Z(t),o="scenario_"+O;t.data("scenario_metabox_id",o),w[o]=e,v.triggerHandler("wc-cp-scenarios-changed"),e.initialize_content(),v.triggerHandler("wc-cp-scenario-added",[e]),v.unblock()})},250),!1}).on("change","input.scenario_action_conditional_options_input, input.scenario_action_conditional_components_input, select.conditional_components_ids, .wc-cp-scenario-conditions-container .os_modifier select",function(){var t=u(this).closest(".bto_scenario").data("scenario_metabox_id");w[t].update_non_effective_conditions_tip()}).on("os_removed os_changed os_added",function(t,e){e=e.$data_container.closest(".bto_scenario").data("scenario_metabox_id");w[e].update_non_effective_conditions_tip()}),et();var D,j,T=u(".cp_scenarios_tab"),ot=T.find("a"),T=(T.prepend('<a class="cp_scenarios_tab_inner" href="#bto_scenario_data"></a>'),T.find("a.cp_scenarios_tab_inner"));function nt(t){var i=this;this.$el=t,this.$content=t.find(".bto_state_data"),this.$metabox_title=t.find("h3 .state_name .state_name_inner"),this.$title_input=this.$content.find("input.bto_state_data_title"),this.render_content=this.$content.data("state_content"),this.initialized_content=!1,this.state_toggled=function(){var t,e,o=this.$el,n=this.$content;B||(e=(t=i.maybe_initialize_content())&&P()?200:t?50:10,setTimeout(function(){o.toggleClass("closed").toggleClass("open"),n.stop().slideToggle({always:function(){t&&P()&&(i.$el.removeClass("loading"),B=!1)}})},e))},this.maybe_initialize_content=function(){var t=!1,e=P()?100:10;return i.initialized_content||(t=!0,P()&&(i.$el.addClass("loading"),B=!0),setTimeout(function(){i.initialize_content()},e)),t},this.title_changed=function(){i.$metabox_title.text(i.$title_input.val())},this.initialize_content=function(){""!==i.render_content&&(i.$content.html(i.render_content),i.$title_input=i.$content.find("input.bto_state_data_title")),i.initialize_select2s(),i.$content.find(".tips, .woocommerce-help-tip").tipTip(d),i.initialized_content=!0,y.triggerHandler("wc-cp-state-initialized",i)},this.initialize_select2s=function(){i.$content.sw_select2({sortable:{stop:function(t){t.hasClass("products_selector")&&(t=t.closest(".bto_group").data("component_metabox_id"),g[t].products_changed())}}})},this.initialize=function(){},this.initialize()}function P(){return 20<h.length}function it(){0<$.length?N.removeClass("disabled"):N.addClass("disabled")}function at(){k={},$.each(function(t){var e=u(this),t="state_"+t;e.data("state_metabox_id",t),k[t]=new nt(e)}),s.sortable({items:".bto_state",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),y.triggerHandler("wc-cp-states-changed")}}),it()}function st(){M.on("click",".expand_all",function(){return u(this).hasClass("disabled")||u.each(k,function(t,e){e.initialize_content(),setTimeout(function(){e.$el.addClass("open").removeClass("closed"),e.$content.show()},50)}),!1}).on("click",".close_all",function(){return u(this).hasClass("disabled")||u.each(k,function(t,e){setTimeout(function(){e.$el.addClass("closed").removeClass("open"),e.$content.hide()},10)}),!1}).on("click",".bto_state_handle",function(){var t=u(this).closest(".bto_state").data("state_metabox_id"),t=k[t];void 0!==t&&t.state_toggled()}).on("click","a.remove_row",function(t){var e=u(this).closest(".bto_state"),o=e.data("state_metabox_id");e.find("*").off(),e.remove(),delete k[o],y.triggerHandler("wc-cp-states-changed"),t.preventDefault()}).on("keyup","input.bto_state_data_title",function(){var t=u(this).closest(".bto_state").data("state_metabox_id");k[t].title_changed()}).on("click",".woocommerce-input-toggle",function(){var t=u(this),e=t.closest(".wc-metabox");return ct(t,e.find(".bto_state_handle .handle > input.enabled")),!1}).on("click","button.add_bto_state",function(){y.block(c),R++;var t={action:"woocommerce_add_composite_state",post_id:woocommerce_admin_meta_boxes.post_id,id:R,security:wc_composite_admin_params.add_state_nonce};return setTimeout(function(){u.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){s.append(t);var t=u(".bto_state",s).last(),e=new nt(t),o="state_"+R;t.data("state_metabox_id",o),k[o]=e,y.triggerHandler("wc-cp-states-changed"),e.initialize_content(),y.triggerHandler("wc-cp-state-added",[e]),y.unblock()})},250),!1}),at()}function ct(t,e){"yes"===e.val()?(e.val("no"),t.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(e.val("yes"),t.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))}function _t(){m.block(c),v.block(c),x&&y.block(c),h.find("*").off();var t={post_id:woocommerce_admin_meta_boxes.post_id,data:u("#bto_product_data, #bto_scenario_data, #bto_state_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};setTimeout(function(){C=u.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){"success"!==t.result&&window.alert(wc_composite_admin_params.i18n_save_error);var e=t.notices,t=t.html,o=[],n=u("#bto_config_group_inner",m),i=u(t).find("#bto_config_group_inner"),a=i.find(".bto_group"),s=[],c=u("#bto_scenarios_inner",v),_=u(t).find("#bto_scenarios_inner"),r=_.find(".bto_scenario"),d=[],l=u("#bto_states_inner",y),t=u(t).find("#bto_states_inner"),p=t.find(".bto_state");h.length===a.length&&h.each(function(){var t=u(this);t.hasClass("open")&&(t=t.attr("rel"),o.push(t))}),a.each(function(){var t=u(this),e=t.attr("rel");-1!==u.inArray(e,o)?(t.addClass("open").removeClass("closed"),t.find(".wc-metabox-content").show()):t.find(".wc-metabox-content").hide()}),b.length===r.length&&c.find(".bto_scenario").each(function(){var t=u(this);t.hasClass("open")&&(t=t.attr("rel"),s.push(t))}),r.each(function(){var t=u(this),e=t.attr("rel");-1!==u.inArray(e,s)?(t.addClass("open").removeClass("closed"),t.find(".wc-metabox-content").show()):t.find(".wc-metabox-content").hide()}),h.find("*").off(),b.find("*").off(),n.html(i.html()),c.html(_.html()),f=n.find(".bulk_toggle_wrapper"),L=c.find(".bulk_toggle_wrapper"),m.triggerHandler("wc-cp-components-changed"),Y(),v.triggerHandler("wc-cp-scenarios-changed"),et(),h.each(function(){var t=u(this);t.hasClass("open")&&(t=t.data("component_metabox_id"),g[t].initialize_content())}),b.each(function(){var t=u(this);t.hasClass("open")&&(t=t.data("scenario_metabox_id"),w[t].initialize_content())}),x&&($.length===p.length&&l.find(".bto_state").each(function(){var t=u(this);t.hasClass("open")&&(t=t.attr("rel"),d.push(t))}),p.each(function(){var t=u(this),e=t.attr("rel");-1!==u.inArray(e,d)?(t.addClass("open").removeClass("closed"),t.find(".wc-metabox-content").show()):t.find(".wc-metabox-content").hide()}),$.find("*").off(),l.html(t.html()),N=l.find(".bulk_toggle_wrapper"),y.triggerHandler("wc-cp-states-changed"),at(),$.each(function(){var t=u(this);t.hasClass("open")&&(t=t.data("state_metabox_id"),k[t].initialize_content())})),0<e.length&&u.each(e,function(t,e){window.alert(e)}),m.unblock(),v.unblock(),x&&y.unblock(),E(C=!1)},"json")},250)}function rt(t){const o=this;this.options=_.defaults(t,{message:"",cta_text:"",cta_url:"",on_click_cta:null,blurred_elements:null,parent_elements:null}),this.blur=function(){o.options.blurred_elements.forEach(function(t){t.classList.add("cp-restriction-section-blurred")})},this.create_overlay_element=function(){var t=document.createElement("div"),e=(t.setAttribute("class","cp-restriction-overlay-upsell"),document.createElement("img"));return e.setAttribute("src",wc_composite_admin_params.restriction.lock_img_src),t.appendChild(e),o.options.message&&((e=document.createElement("p")).textContent=o.options.message,t.appendChild(e)),o.options.cta_text&&((e=document.createElement("a")).setAttribute("class","button button-primary button-large cta"),e.setAttribute("target","_blank"),e.setAttribute("href",o.options.cta_url),e.textContent=o.options.cta_text,o.options.on_click_cta instanceof Function&&(e.onclick=o.options.on_click_cta),t.appendChild(e)),t},this.append_overlay=function(){o.options.parent_elements.forEach(function(t){var e=o.create_overlay_element();t.appendChild(e),t.classList.add("cp-restriction-section-overlay-container")})},this.show=function(){o.blur(),o.append_overlay()}}function S(t){const n=this;this.options=_.defaults(t,{parent_elements:null,message:"",on_click_cta:null,insert_strategy:"prepend",on_show:null}),this.create_notice_element=function(){var t=document.createElement("div"),e=(t.setAttribute("class","cp-restriction-notice"),document.createElement("p")),o=(e.innerHTML=n.options.message,e.querySelector("a"));return o.target="_blank",o&&n.options.on_click_cta instanceof Function&&(o.onclick=n.options.on_click_cta),t.appendChild(e),t},this.show=function(){n.options.parent_elements.forEach(function(t){var e=n.create_notice_element();switch(n.options.insert_strategy){case"append":t.append(e);break;case"prepend":t.prepend(e)}}),n.options.on_show instanceof Function&&n.options.on_show()}}function dt(t){const o=this;this.options=_.defaults(t,{restricted_option_key:"",restricted_option_class:"",parent_initialize_event:"",parent_container:null,popup:null}),this.restrict_item=function(t){u(t.$content).find(`option[value="${o.options.restricted_option_key}"]`).attr("disabled",!0),o.options.popup&&new lt({attachment_selector:t.$content,message:o.options.popup.message,cta_text:o.options.popup.cta_text,cta_url:o.options.popup.cta_url,on_click_cta:o.options.popup.on_click_cta,offset_top:o.options.popup.offset_top,offset_left:o.options.popup.offset_left,on_show:o.options.popup.on_show,on_hide:o.options.popup.on_hide,setup_show_trigger:function(e){u(t.$content).find("select").on("select2:open",function(t){u(t.currentTarget).hasClass(o.options.restricted_option_class)&&(e.change_offset_left(190+u(t.currentTarget).next("span.sw-select2-container").innerWidth()/2+"px"),u(t.currentTarget).next("span.sw-select2-container").hasClass("select2-container--above")?e.change_offset_top("0px"):e.change_offset_top("70px"),e.show())})},setup_hide_trigger:function(e){u(t.$content).find("select").on("select2:close",function(t){setTimeout(function(){e.is_cta_navigating||u(t.currentTarget).hasClass(o.options.restricted_option_class)&&e.hide()},100)})}}).restrict()},this.restrict=function(){o.options.parent_container&&o.options.parent_container.on(o.options.parent_initialize_event,function(t,e){o.options.restricted_option_key!==e.$query_type_selector.val()&&o.restrict_item(e)})}}function lt(t){const a=this;this.options=_.defaults(t,{attachment_selector:null,offset_top:0,offset_left:0,message:"",cta_text:"",cta_url:"",on_show:null,on_hide:null,setup_show_trigger:null,setup_hide_trigger:null,on_click_cta:null}),this.overlay=null,this.is_cta_navigating=!1,this.create_popup_element=function(){a.overlay=document.createElement("div"),a.overlay.className="cp-restriction-overlay-upsell-popover",a.overlay.style.display="none",a.overlay.style.top=a.options.offset_top,a.overlay.style.left=a.options.offset_left;var t=document.createElement("div"),e=(t.className="popover-content",document.createElement("button")),o=(e.className="close-btn",e.innerHTML="&times;",e.onclick=function(t){t.preventDefault(),a.hide()},document.createElement("img")),n=(o.src=wc_composite_admin_params.restriction.lock_img_src,o.alt="Locked",document.createElement("p"));n.textContent=a.options.message;const i=document.createElement("a");i.href=a.options.cta_url,i.className="button button-primary button-large",i.textContent=a.options.cta_text,i.target="_blank",i.onclick=function(){a.is_cta_navigating=!0,i.classList.add("button-disabled"),i.disabled=!0,a.options.on_click_cta instanceof Function&&a.options.on_click_cta()},t.appendChild(e),t.appendChild(o),t.appendChild(n),t.appendChild(i),a.overlay.appendChild(t)},this.restrict=function(){a.create_popup_element();var t=u(a.options.attachment_selector);t.length&&(t.prepend(a.overlay),a.options.setup_show_trigger instanceof Function&&a.options.setup_show_trigger(a),a.options.setup_hide_trigger instanceof Function)&&a.options.setup_hide_trigger(a)},this.hide=function(){a.options.on_hide instanceof Function&&a.options.on_hide(),u(a.overlay).hide()},this.show=function(){a.is_cta_navigating=!1,a.options.on_show instanceof Function&&a.options.on_show(),u(a.overlay).show()},this.change_offset_top=function(t){a.overlay.style.top=t},this.change_offset_left=function(t){a.overlay.style.left=t}}function pt(t,e){e.advanced_settings_restriction=new rt({blurred_elements:e.$el.find(".tab_group_advanced .options_group_component").get(),parent_elements:e.$el.find(".tab_group_advanced").get(),cta_text:wc_composite_admin_params.restriction.i18n_cta_text,cta_url:wc_composite_admin_params.restriction.cta_url,message:wc_composite_admin_params.restriction.i18n_message,on_click_cta:function(){wc_composite_admin_params.restriction.tracks_event&&WC_CP.tracks.recordEvent(wc_composite_admin_params.restriction.tracks_event,{source:"component_advanced_settings"})}}),e.advanced_settings_restriction.show(),e.$el.find('a[data-tab="advanced"]').one("click",function(){WC_CP.tracks.recordEvent("product_restriction_shown",{source:"component_advanced_settings",cta_tracks_event:wc_composite_admin_params.restriction.tracks_event})})}if(T.html(ot.html()),T.on("click",function(){return U&&!C?window.confirm(wc_composite_admin_params.i18n_scenarios_panel_blocked)&&(ot.trigger("click"),setTimeout(function(){_t()},150)):ot.trigger("click"),!1}),x&&y.on("wc-cp-state-initialized",function(t,e){e=e.$content.find(".wc-cp-state-conditions-container");e.length&&new H(e,m)}),x&&(st(),j=u(".cp_states_tab"),D=j.find("a"),j.prepend('<a class="cp_states_tab_inner" href="#bto_scenario_data"></a>'),(j=j.find("a.cp_states_tab_inner")).html(D.html()),j.on("click",function(){return U&&!C?window.confirm(wc_composite_admin_params.i18n_states_panel_blocked)&&(D.trigger("click"),setTimeout(function(){_t()},150)):D.trigger("click"),!1})),"yes"===wc_composite_admin_params.is_first_composite&&n.val("composite").trigger("change").trigger("focus"),t.detach().prependTo(l),l.find(".form-field._weight_field").after(t.find(".form-field.composite_aggregate_weight_field")),z.on("change",function(){var t=z.prop("checked");p.prop("checked")!==t&&p.prop("checked",t).trigger("change"),t?m.addClass("composite_virtual"):m.removeClass("composite_virtual")}),q.on("click",function(){var t=u(this),e=t.find("input").prop("checked","checked").val();q.removeClass("selected"),t.addClass("selected"),t.attr("aria-checked",!0),"assembled"===e?(l.removeClass("composite_unassembled"),m.removeClass("composite_unassembled")):"unassembled"===e&&(l.addClass("composite_unassembled"),m.addClass("composite_unassembled"))}),q.on("focus",function(){var t=u(this);q.attr("tabindex",-1),t.attr("tabindex",0)}),q.on("keydown",function(t){"ArrowRight"===t.key||"ArrowDown"===t.key?(t.preventDefault(),u(this).next().click().focus()):"ArrowLeft"!==t.key&&"ArrowUp"!==t.key||(t.preventDefault(),u(this).prev().click().focus())}),n.trigger("change"),wc_composite_admin_params.restriction.is_restricted){{function ut(){wc_composite_admin_params.restriction.tracks_event&&WC_CP.tracks.recordEvent(wc_composite_admin_params.restriction.tracks_event,{source:"category"})}const ht=_.once(function(){WC_CP.tracks.recordEvent("product_restriction_shown",{source:"category",cta_tracks_event:wc_composite_admin_params.restriction.tracks_event})});new dt({restricted_option_key:"category_ids",restricted_option_class:"component_query_type",parent_initialize_event:"wc-cp-component-initialized",parent_container:m,popup:{message:wc_composite_admin_params.restriction.i18n_message,cta_text:wc_composite_admin_params.restriction.i18n_cta_text,cta_url:wc_composite_admin_params.restriction.cta_url,on_click_cta:ut,on_show:ht}}).restrict(),m.on("wc-cp-component-initialized",function(t,e){"category_ids"===e.$query_type_selector.val()&&new S({parent_elements:[e.$content.find("select.component_query_type").parent()],message:wc_composite_admin_params.restriction.i18n_message_with_cta,on_click_cta:ut,on_show:ht}).show()})}T.one("click",function(){WC_CP.tracks.recordEvent("product_restriction_shown",{source:"scenario",cta_tracks_event:wc_composite_admin_params.restriction.tracks_event})}),0===b.length?new rt({blurred_elements:u("#bto_scenario_data .scenarios_config_group").get(),parent_elements:u("#bto_scenario_data").get(),cta_text:wc_composite_admin_params.restriction.i18n_cta_text,cta_url:wc_composite_admin_params.restriction.cta_url,message:wc_composite_admin_params.restriction.i18n_message,on_click_cta:ft}).show():(j="cp-restriction-notice-container",(t=document.createElement("div")).classList.add("toolbar"),t.classList.add(j),(T=document.querySelector("#bto_scenarios_inner .toolbar"))&&(T.after(t),new S({parent_elements:document.querySelectorAll("."+j),message:wc_composite_admin_params.restriction.i18n_message_with_cta,on_click_cta:ft}).show()));{new rt({blurred_elements:u(".bto_layout_button.restricted_layout .layout_img, .bto_layout_button.restricted_layout .woocommerce-help-tip").get(),parent_elements:u(".bto_layout_button.restricted_layout").get()}).show();const W=function(){W.fired||(WC_CP.tracks.recordEvent("product_restriction_shown",{source:"component_layout",cta_tracks_event:wc_composite_admin_params.restriction.tracks_event}),W.fired=!0)};function mt(){wc_composite_admin_params.restriction.tracks_event&&WC_CP.tracks.recordEvent(wc_composite_admin_params.restriction.tracks_event,{source:"component_layout"})}new lt({attachment_selector:"#woocommerce-product-data",message:wc_composite_admin_params.restriction.i18n_message,cta_text:wc_composite_admin_params.restriction.i18n_cta_text,cta_url:wc_composite_admin_params.restriction.cta_url,offset_top:0,offset_left:0,on_click_cta:mt,setup_show_trigger:function(o){u(".bto_layout_button.restricted_layout").on("click",function(t){var e=u(this).position();o.hide(),o.change_offset_left(e.left+43+"px"),o.change_offset_top("-160px"),o.show(),W(),t.preventDefault()})},setup_hide_trigger:function(e){u(document).on("click",function(t){u(t.target).is([".cp-restriction-overlay-upsell-popover",".cp-restriction-overlay-upsell",".cp-restriction-overlay-upsell-popover *",".cp-restriction-overlay-upsell *"].join(", "))||e.hide()})}}).restrict(),"single"!==u('input[name="bto_style"]:checked').val()&&(new S({parent_elements:u(".bto_layouts").get(),message:wc_composite_admin_params.restriction.i18n_message_with_cta,on_click_cta:mt,insert_strategy:"append"}).show(),u(".cp_components_tab").on("click",function(){W()}))}new S({parent_elements:u(".tab_group_advanced").get(),message:wc_composite_admin_params.restriction.i18n_message_with_cta,on_click_cta:function(){wc_composite_admin_params.restriction.tracks_event&&WC_CP.tracks.recordEvent(wc_composite_admin_params.restriction.tracks_event,{source:"component_advanced_settings"})}}).show(),u(".bto_group_data").find('a[data-tab="advanced"]').one("click",function(){WC_CP.tracks.recordEvent("product_restriction_shown",{source:"component_advanced_settings",cta_tracks_event:wc_composite_admin_params.restriction.tracks_event})}),m.on("wc-cp-component-added",pt)}function ft(){wc_composite_admin_params.restriction.tracks_event&&WC_CP.tracks.recordEvent(wc_composite_admin_params.restriction.tracks_event,{source:"scenario"})}$layout_options.on("click",function(t){var e=u(this);t.isDefaultPrevented()||($layout_options.removeClass("selected"),$layout_options.attr("aria-checked",!1),e.addClass("selected"),e.attr("aria-checked",!0))}),$layout_options.on("focus",function(){var t=u(this);$layout_options.attr("tabindex",-1),t.attr("tabindex",0)}),$layout_options.on("keydown",function(t){"ArrowRight"===t.key||"ArrowDown"===t.key?(t.preventDefault(),u(this).next().click().focus()):"ArrowLeft"!==t.key&&"ArrowUp"!==t.key||(t.preventDefault(),u(this).prev().click().focus())})});