(()=>{"use strict";const e=window.React,t=window.wp.element,n=window.wp.i18n,r=window.wc.wcBlocksRegistry,a=window.wp.htmlEntities,o=window.wc.wcSettings,s=(0,o.getSetting)("bizumredsys_data",{}),l=(0,o.getSetting)("paygold_data",{}),i=(0,o.getSetting)("masterpass_data",{}),c=(0,o.getSetting)("redsysbank_data",{}),d=(0,o.getSetting)("directdebitredsys_data",{}),p=(0,o.getSetting)("insite_data",{}),m=(0,o.getSetting)("redsys_data",{}),u=(0,o.getSetting)("googlepayredirecredsys_data",{}),y=(0,o.getSetting)("applepayredsys_data",{}),{CHECKOUT_STORE_KEY:g}=window.wc.wcBlocksData,E=wp.data.select(g),w=function(){const e=[s,l,i,c,d,p,m,u,y];for(const t of e)if(t.logodisplayoption&&"right"!==t.logodisplayoption)return t.logodisplayoption;return"right"}(),b=()=>(0,a.decodeEntities)(s.description||""),f=()=>(0,a.decodeEntities)(l.description||""),h=()=>(0,a.decodeEntities)(i.description||""),k=()=>(0,a.decodeEntities)(c.description||""),_=()=>(0,a.decodeEntities)(d.description||""),S=()=>(0,e.createElement)("div",null,(0,a.decodeEntities)(m.description||"")),P=()=>(0,a.decodeEntities)(u.description||""),v=()=>((0,t.useEffect)((()=>{(async()=>{const e=E.getOrderId(),t=await async function(e){try{const t=await fetch(`/wp-json/woocommerce-redsys/v1/prepare_order_number/${e}`);if(!t.ok)throw new Error("Failed to fetch prepared order number");return(await t.text()).replace(/^"|"$/g,"")}catch(e){return console.error("Error fetching prepared order number:",e),null}}(e);if(!t)return void console.error("No se pudo obtener el número de pedido preparado");const n=document.createElement("script");n.src=p.script_url,n.async=!0,document.head.appendChild(n);const r=document.getElementById("card-form");r&&(r.innerHTML='\n                    <input type="hidden" id="token"/>\n                    <input type="hidden" id="errorCode"/>\n                ');const a=()=>!0;window.addEventListener("message",(function(n){if(n.origin!==new URL(p.script_url).origin)return void console.warn("Origen no válido:",n.origin);storeIdOper(n,"token","errorCode",a);const r=document.getElementById("token").value,o=document.getElementById("errorCode").value;console.log("Token recibido:",r),console.log("Error Code recibido:",o),async function(e,t,n){try{const r=await fetch("/wp-json/woocommerce-redsys/v1/save_order_data",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:e,modified_order_number:t,token:n})});if((await r.json()).success){console.log("Order data saved successfully");const e=document.querySelector(".wc-block-components-checkout-place-order-button");e?e.click():console.error("Pay button not found")}else console.error("Failed to save order data")}catch(e){console.error("Error saving order data:",e)}}(e,t,r)})),n.onload=()=>{const e={id:"card-form",fuc:p.fuc,terminal:p.terminal,order:t,mostrarLogo:!1,estiloInsite:p.insitetipo||"inline"};if("function"==typeof getInSiteFormJSON)try{getInSiteFormJSON(e),console.log("getInSiteFormJSON ejecutado correctamente.")}catch(e){console.error("Error en getInSiteFormJSON:",e)}else console.error("Error: La función getInSiteFormJSON no está definida.")};const o=document.getElementById("redsys-hosted-pay-button");o&&(o.onload=()=>{o.style.height=p.alturaiframe||"250px"})})()}),[]),(0,e.createElement)("div",null,(0,e.createElement)("style",null,"\n                .wc-block-components-checkout-place-order-button {\n                    display: none !important;\n                }\n                "),(0,e.createElement)("div",null,(0,e.createElement)("p",null,(0,a.decodeEntities)(p.description||"")),(0,e.createElement)("div",{id:"card-form"})))),M=()=>((0,t.useEffect)((()=>{const e=document.createElement("apple-pay-button");e.setAttribute("buttonstyle","black"),e.setAttribute("type","buy"),e.setAttribute("locale","es-ES"),e.addEventListener("click",onApplePayClicked);const t=document.getElementById("apple-pay-button-container");t.appendChild(e);const n=document.createElement("input");n.type="hidden",n.id="apple-token-redsys",n.name="apple-token-redsys";const r=document.createElement("input");return r.type="hidden",r.id="apple-referencia-redsys",r.name="apple-referencia-redsys",t.appendChild(n),t.appendChild(r),()=>e.removeEventListener("click",onApplePayClicked)}),[]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)("style",null,"\n\t\t\t  apple-pay-button {\n\t\t\t\t--apple-pay-button-width: 280px;\n\t\t\t\t--apple-pay-button-height: 56px;\n\t\t\t  }\n\t\t\t"),(0,e.createElement)("div",{id:"apple-pay-button-container"})));function I(t,n){switch(w){case"left":return(0,e.createElement)("div",{style:{display:"flex",alignItems:"center"}},n&&(0,e.createElement)("img",{src:n,alt:t,style:{marginRight:"8px"}}),(0,e.createElement)("span",null,t));case"right":return(0,e.createElement)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"}},(0,e.createElement)("span",null,t),n&&(0,e.createElement)("img",{src:n,alt:t}));case"iconOnly":return(0,e.createElement)("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",width:"100%"}},n&&(0,e.createElement)("img",{src:n,alt:t}));default:return(0,e.createElement)("div",{style:{display:"flex",alignItems:"center"}},(0,e.createElement)("span",null,t),n&&(0,e.createElement)("img",{src:n,alt:t,style:{marginLeft:"8px"}}))}}if(s.enabled&&(0,r.registerPaymentMethod)({name:"bizumredsys",label:I(s.title,s.icon),content:(0,e.createElement)(b,null),edit:(0,e.createElement)(b,null),canMakePayment:()=>!0,ariaLabel:(0,n.__)("Bizum","woocommerce-redsys"),supports:{features:s.supports}}),l.enabled&&(0,r.registerPaymentMethod)({name:"paygold",label:I(l.title,l.icon),content:(0,e.createElement)(f,null),edit:(0,e.createElement)(f,null),canMakePayment:()=>l.show,ariaLabel:(0,n.__)("Paygold","woocommerce-redsys"),supports:{features:l.supports}}),i.enabled&&(0,r.registerPaymentMethod)({name:"masterpass",label:I(i.title,i.icon),content:(0,e.createElement)(h,null),edit:(0,e.createElement)(h,null),canMakePayment:()=>!0,ariaLabel:(0,n.__)("Masterpass","woocommerce-redsys"),supports:{features:i.supports}}),c.enabled&&(0,r.registerPaymentMethod)({name:"redsysbank",label:I(c.title,c.icon),content:(0,e.createElement)(k,null),edit:(0,e.createElement)(k,null),canMakePayment:()=>!0,ariaLabel:(0,n.__)("Redsys Bank Transfer","woocommerce-redsys"),supports:{features:c.supports}}),d.enabled&&(0,r.registerPaymentMethod)({name:"directdebitredsys",label:I(d.title,d.icon),content:(0,e.createElement)(_,null),edit:(0,e.createElement)(_,null),canMakePayment:()=>!0,ariaLabel:(0,n.__)("Direct Debit","woocommerce-redsys"),supports:{features:d.supports}}),p.enabled&&(0,r.registerPaymentMethod)({name:"insite",label:I(p.title,p.icon),content:(0,e.createElement)(v,null),edit:(0,e.createElement)(v,null),canMakePayment:()=>!0,ariaLabel:(0,n.__)("InSite","woocommerce-redsys"),supports:{showSavedCards:p.tokens,showSaveOption:p.tokens,features:p.supports||["products","refunds"]}}),m.enabled&&(0,r.registerPaymentMethod)({name:"redsys",label:I(m.title,m.icon),content:(0,e.createElement)(S,null),edit:(0,e.createElement)(S,null),canMakePayment:()=>!0,ariaLabel:(0,n.__)("Redsys","woocommerce-redsys"),supports:{showSavedCards:m.tokens,showSaveOption:m.tokens,features:m.supports}}),u.enabled&&(0,r.registerPaymentMethod)({name:"googlepayredirecredsys",label:I(u.title,u.icon),content:(0,e.createElement)(P,null),edit:(0,e.createElement)(P,null),canMakePayment:()=>!0,ariaLabel:(0,n.__)("Google Pay","woocommerce-redsys"),supports:{features:u.supports}}),y.enabled){const t={name:"applepayredsys",label:I(y.title,y.icon),content:(0,e.createElement)(M,null),edit:(0,e.createElement)("div",null,"Apple Pay Configuration"),canMakePayment:async()=>!(!window.ApplePaySession||!applePayRedsysParams.productosVirtuales)&&ApplePaySession.canMakePayments(),paymentMethodId:"applepayredsys"};(0,r.registerExpressPaymentMethod)(t)}})();